var B=Object.defineProperty;var C=(l,t,e)=>t in l?B(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var k=(l,t,e)=>(C(l,typeof t!="symbol"?t+"":t,e),e),N=(l,t,e)=>{if(!t.has(l))throw TypeError("Cannot "+e)};var o=(l,t,e)=>(N(l,t,"read from private field"),e?e.call(l):t.get(l)),h=(l,t,e)=>{if(t.has(l))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(l):t.set(l,e)},y=(l,t,e,a)=>(N(l,t,"write to private field"),a?a.call(l,e):t.set(l,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function a(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();var f,D,_,w,E;class O{constructor({taskID:t=null,text:e,position:a,startDate:s,endDate:n}){h(this,f,null);h(this,D,"");h(this,_,-1);h(this,w,null);h(this,E,null);y(this,f,t||crypto.randomUUID()),y(this,D,e),y(this,_,a),y(this,w,s),y(this,E,n)}get taskID(){return o(this,f)}get taskText(){return o(this,D)}set taskText(t){typeof t=="string"&&y(this,D,t)}get taskPosition(){return o(this,_)}set taskPosition(t){typeof t=="number"&&t>=0&&y(this,_,t)}get taskStartDate(){return o(this,w)}get taskEndDate(){return o(this,E)}render(){const t=document.createElement("li");t.classList.add("tasklist__tasks-list-item","task"),t.setAttribute("id",o(this,f)),t.setAttribute("draggable",!0),t.addEventListener("dragstart",c=>{c.target.classList.add("task_selected"),localStorage.setItem("movedTaskID",o(this,f))}),t.addEventListener("dragend",c=>c.target.classList.remove("task_selected"));const e=document.createElement("div");e.classList.add("upper_task_row");const a=document.createElement("span");a.classList.add("task__text"),a.innerHTML=o(this,D),e.appendChild(a);const s=document.createElement("button");s.setAttribute("type","button"),s.classList.add("task__contol-btn","edit-icon"),s.addEventListener("click",()=>{localStorage.setItem("editTaskID",o(this,f)),document.getElementById("modal-edit-task").showModal()}),e.appendChild(s),t.appendChild(e);const n=document.createElement("div");n.classList.add("lower_task_row");const i=document.createElement("div");i.classList.add("date-div");const r=document.createElement("span");r.classList.add("task__start-date"),r.innerHTML=new Date(o(this,w)).toLocaleDateString("en-US"),i.appendChild(r);const d=document.createElement("span");d.classList.add("task__end-date"),d.innerHTML=new Date(o(this,E)).toLocaleDateString("en-US"),i.appendChild(d),n.appendChild(i);const p=document.createElement("button");return p.setAttribute("type","button"),p.classList.add("task__contol-btn","delete-icon"),p.addEventListener("click",()=>{localStorage.setItem("deleteTaskID",o(this,f));const c=document.getElementById("modal-delete-task");c.querySelector(".app-modal__question").innerHTML=`Задача ${o(this,D)} будет удалена. Продолжить?`,c.showModal()}),n.appendChild(p),t.appendChild(n),t}}f=new WeakMap,D=new WeakMap,_=new WeakMap,w=new WeakMap,E=new WeakMap;class S{static async getTasklists(){try{const t=await fetch("http://localhost:4321/tasklists"),e=await t.json();return t.status!==200?Promise.reject(e):e.tasklists}catch(t){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:t.message})}}static async addTasklist({tasklistID:t,name:e,position:a}={tasklistID:null,name:"",position:-1}){try{const s=await fetch("http://localhost:4321/tasklists",{method:"POST",body:JSON.stringify({tasklistID:t,name:e,position:a}),headers:{"Content-Type":"application/json"}});if(s.status!==200){const n=await s.json();return Promise.reject(n)}return{timestamp:new Date().toISOString(),message:`Список задач ${e} был успешно добавлен`}}catch(s){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:s.message})}}static async addTask({taskID:t,text:e,position:a,tasklistID:s,startDate:n,endDate:i}={taskID:null,text:"",position:-1,tasklistID:null,startDate:null,endDate:null}){try{const r=await fetch("http://localhost:4321/tasks",{method:"POST",body:JSON.stringify({taskID:t,text:e,position:a,tasklistID:s,startDate:n,endDate:i}),headers:{"Content-Type":"application/json"}});if(r.status!==200){const d=await r.json();return Promise.reject(d)}return{timestamp:new Date().toISOString(),message:`Задача ${e} была успешно добавлена`}}catch(r){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:r.message})}}static async updateTask({taskID:t,text:e,position:a=-1,startDate:s,endDate:n}={taskID:null,text:"",position:-1,startDate:"",endDate:""}){try{const i=await fetch(`http://localhost:4321/tasks/${t}`,{method:"PATCH",body:JSON.stringify({text:e,position:a,startDate:s,endDate:n}),headers:{"Content-Type":"application/json"}});if(i.status!==200){const r=await i.json();return Promise.reject(r)}return{timestamp:new Date().toISOString(),message:`Задача ${e} была успешно изменена`}}catch(i){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:i.message})}}static async updateTasks({reorderedTasks:t=[]}={reorderedTasks:[]}){try{const e=await fetch("http://localhost:4321/tasks",{method:"PATCH",body:JSON.stringify({reorderedTasks:t}),headers:{"Content-Type":"application/json"}});if(e.status!==200){const a=await e.json();return Promise.reject(a)}return{timestamp:new Date().toISOString(),message:`Задача ${text} была успешно изменена`}}catch(e){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:e.message})}}static async deleteTask({taskID:t,text:e}={taskID:null,text:""}){try{const a=await fetch(`http://localhost:4321/tasks/${t}`,{method:"DELETE"});if(a.status!==200){const s=await a.json();return Promise.reject(s)}return{timestamp:new Date().toISOString(),message:`Задача (ID = ${t}) была успешно удалена`}}catch(a){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:a.message})}}static async moveTask({taskID:t,srcTasklistID:e,destTasklistID:a}={taskID:null,srcTasklistID:null,destTasklistID:null}){try{const s=await fetch("http://localhost:4321/tasklists",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({taskID:t,srcTasklistID:e,destTasklistID:a})});if(s.status!==200){const n=await s.json();return Promise.reject(n)}return{timestamp:new Date().toISOString(),message:`Задача ${t} была успешно перемещена между списками`}}catch(s){return Promise.reject({timestamp:new Date().toISOString(),statusCode:0,message:s.message})}}}var m,v,T,L;class x{constructor({tasklistID:t=null,name:e,position:a,onDropTaskInTasklist:s,addNotification:n}){h(this,m,[]);h(this,v,"");h(this,T,null);h(this,L,-1);k(this,"pushTask",({task:t})=>o(this,m).push(t));k(this,"getTaskById",({taskID:t})=>o(this,m).find(e=>e.taskID===t));k(this,"deleteTask",({taskID:t})=>{const e=o(this,m).findIndex(s=>s.taskID===t);if(e===-1)return;const[a]=o(this,m).splice(e,1);return a});k(this,"reorderTasks",async()=>{const t=Array.from(document.querySelector(`[id="${o(this,T)}"] .tasklist__tasks-list`).children,a=>a.getAttribute("id")),e=[];if(t.forEach((a,s)=>{const n=o(this,m).find(i=>i.taskID===a);n.tasklistPosition!==s&&(n.tasklistPosition=s,e.push(a,s))}),e.lenght>0)try{await S.updateTasks({reorderedTasks:e})}catch(a){this.addNotification({text:a.message,type:"error"}),console.error(a)}});k(this,"appendNewTask",async({text:t,startDate:e,endDate:a})=>{try{const s=crypto.randomUUID(),n=await S.addTask({taskID:s,text:t,position:o(this,m).length,tasklistID:o(this,T),startDate:e,endDate:a});this.addNewTaskLocal({taskID:s,text:t,position:o(this,m).length,startDate:e,endDate:a}),this.addNotification({text:n.message,type:"success"})}catch(s){this.addNotification({text:s.message,type:"error"}),console.error(s)}});k(this,"addNewTaskLocal",({taskID:t=null,text:e,position:a,startDate:s,endDate:n})=>{const i=new O({taskID:t,text:e,position:a,startDate:s,endDate:n});o(this,m).push(i);const r=i.render();document.querySelector(`[id="${o(this,T)}"] .tasklist__tasks-list`).appendChild(r)});y(this,v,e),y(this,T,t||crypto.randomUUID()),y(this,L,a),this.onDropTaskInTasklist=s,this.addNotification=n}get tasklistID(){return o(this,T)}get tasklistPosition(){return o(this,L)}get tasklistTasks(){return o(this,m)}render(){const t=document.createElement("li");t.classList.add("tasklists-list__item","tasklist"),t.setAttribute("id",o(this,T)),t.addEventListener("dragstart",()=>localStorage.setItem("srcTasklistID",o(this,T))),t.addEventListener("drop",this.onDropTaskInTasklist);const e=document.createElement("h2");e.classList.add("tasklist__name"),e.innerHTML=o(this,v),t.appendChild(e);const a=document.createElement("ul");a.classList.add("tasklist__tasks-list"),t.appendChild(a);const s=document.createElement("button");s.setAttribute("type","button"),s.classList.add("tasklist__add-task-btn"),s.innerHTML="&#10010; Добавить карточку",s.addEventListener("click",()=>{localStorage.setItem("addTaskTasklistID",o(this,T)),document.getElementById("modal-add-task").showModal()}),t.appendChild(s);const n=document.querySelector(".tasklist-adder");n.parentElement.insertBefore(t,n)}}m=new WeakMap,v=new WeakMap,T=new WeakMap,L=new WeakMap;var u;class j{constructor(){h(this,u,[]);k(this,"onEscapeKeydown",t=>{if(t.key==="Escape"){const e=document.querySelector(".tasklist-adder__input");e.style.display="none",e.value="",document.querySelector(".tasklist-adder__btn").style.display="inherit"}});k(this,"onInputKeydown",async t=>{if(t.key==="Enter"){if(t.target.value){const e=crypto.randomUUID();try{const a=await S.addTasklist({tasklistID:e,name:t.target.value,position:o(this,u).length}),s=new x({tasklistID:e,name:t.target.value,position:o(this,u).length,onDropTaskInTasklist:this.onDropTaskInTasklist,addNotification:this.addNotification});o(this,u).push(s),s.render(),this.addNotification({text:a.message,type:"success"})}catch(a){this.addNotification({text:a.message,type:"error"}),console.error(a)}}t.target.style.display="none",t.target.value="",document.querySelector(".tasklist-adder__btn").style.display="inherit"}});k(this,"onDropTaskInTasklist",async t=>{t.stopPropagation();const e=t.currentTarget;e.classList.remove("tasklist_droppable");const a=localStorage.getItem("movedTaskID"),s=localStorage.getItem("srcTasklistID"),n=e.getAttribute("id");if(localStorage.setItem("movedTaskID",""),localStorage.setItem("srcTasklistID",""),!e.querySelector(`[id="${a}"]`))return;const i=o(this,u).find(d=>d.tasklistID===s),r=o(this,u).find(d=>d.tasklistID===n);try{if(s!==n){await S.moveTask({taskID:a,srcTasklistID:s,destTasklistID:n});const d=i.deleteTask({taskID:a});r.pushTask({task:d}),i.reorderTasks()}await r.reorderTasks(),this.addNotification({text:`Задача была успешно перемещена в список ${r.name}`,type:"success"})}catch(d){this.addNotification({text:d.message,type:"error"}),console.error(d)}});k(this,"editTask",async({taskID:t,newTaskText:e,editedStartDate:a,editedEndDate:s})=>{let n=null;for(let i of o(this,u))if(n=i.getTaskById({taskID:t}),n)break;try{const i=await S.updateTask({taskID:t,text:e,startDate:a,endDate:s});n.taskText=e,n.startDate=a,n.endDate=s,document.querySelector(`[id="${t}"] span.task__text`).innerHTML=e,document.querySelector(`[id="${t}"] span.task__start-date`).innerHTML=new Date(a).toLocaleDateString("en-US"),document.querySelector(`[id="${t}"] span.task__end-date`).innerHTML=new Date(s).toLocaleDateString("en-US"),this.addNotification({text:i.message,type:"success"})}catch(i){this.addNotification({text:i.message,type:"error"}),console.error(i)}});k(this,"deleteTask",async({taskID:t})=>{let e=null,a=null;for(let s of o(this,u))if(a=s,e=s.getTaskById({taskID:t}),e)break;try{const s=await S.deleteTask({taskID:t});a.deleteTask({taskID:t}),document.getElementById(t).remove(),this.addNotification({text:s.message,type:"success"})}catch(s){this.addNotification({text:s.message,type:"error"}),console.error(s)}});k(this,"addNotification",({text:t,type:e})=>{const a=document.getElementById("app-notifications"),s=crypto.randomUUID(),n=document.createElement("div");n.classList.add("notification",e==="success"?"notification-success":"notification-error"),n.setAttribute("id",s),n.innerHTML=t,a.appendChild(n),setTimeout(()=>{document.getElementById(s).remove()},5e3)})}initAddTaskModal(){const t=document.getElementById("modal-add-task"),e=()=>{t.close(),localStorage.setItem("addTaskTasklistID",""),localStorage.setItem("addTaskStartTime",""),localStorage.setItem("addTaskEndTime",""),t.querySelector(".app-modal__input").value="",t.querySelector(".app-modal__sdate-input").value="",t.querySelector(".app-modal__edate-input").value=""},a=()=>{const s=localStorage.getItem("addTaskTasklistID"),n=t.querySelector(".app-modal__input"),i=t.querySelector(".app-modal__sdate-input"),r=t.querySelector(".app-modal__edate-input"),d=new Date(i.value),p=new Date(r.value);let c=0;if(s&&i.value&&r.value&&n.value){const I=o(this,u).find(g=>g.tasklistID===s);if(I.tasklistTasks.length>0)for(let g of I.tasklistTasks){let b=new Date(g.taskStartDate),q=new Date(g.taskEndDate);if(!(d>=q||b>=p)){c=1;break}}c===1?this.addNotification({text:"Аренда на данный промежуток времени недоступна",type:"error"}):o(this,u).find(g=>g.tasklistID===s).appendNewTask({text:n.value,startDate:i.value,endDate:r.value})}else(!n.value||!i.value||!r.value)&&this.addNotification({text:"Пожалуйста, введите все необходимые данные",type:"error"});e()};t.querySelector(".modal-ok__btn").addEventListener("click",a),t.querySelector(".modal-cancel__btn").addEventListener("click",e),t.addEventListener("close",e)}initEditTaskModal(){const t=document.getElementById("modal-edit-task"),e=()=>{t.close(),localStorage.setItem("editTaskID",""),t.querySelector(".app-modal__input").value="",t.querySelector(".app-modal__sdate-input").value="",t.querySelector(".app-modal__edate-input").value=""},a=()=>{let s=null,n=null,i=0;const r=localStorage.getItem("editTaskID"),d=t.querySelector(".app-modal__input"),p=t.querySelector(".app-modal__sdate-input"),c=t.querySelector(".app-modal__edate-input");if(r&&p.value&&c.value&&d.value){for(let I of o(this,u))if(n=I,s=I.getTaskById({taskID:r}),s)break;if(n.tasklistTasks.length>0){const I=new Date(p.value),g=new Date(c.value);for(let b of n.tasklistTasks){let q=new Date(b.taskStartDate),P=new Date(b.taskEndDate);if(!(I>=P||q>=g)){i=1;break}}}i===1?this.addNotification({text:"Аренда на данный промежуток времени недоступна",type:"error"}):this.editTask({taskID:r,newTaskText:d.value,editedStartDate:p.value,editedEndDate:c.value})}else(!d.value||!p.value||!c.value)&&this.addNotification({text:"Пожалуйста, введите все необходимые данные",type:"error"});e()};t.querySelector(".modal-ok__btn").addEventListener("click",a),t.querySelector(".modal-cancel__btn").addEventListener("click",e),t.addEventListener("close",e)}initDeleteTaskModal(){const t=document.getElementById("modal-delete-task"),e=()=>{t.close(),localStorage.setItem("deleteTaskID","")},a=()=>{const s=localStorage.getItem("deleteTaskID");s&&this.deleteTask({taskID:s}),e()};t.querySelector(".modal-ok__btn").addEventListener("click",a),t.querySelector(".modal-cancel__btn").addEventListener("click",e),t.addEventListener("close",e)}initNotifications(){document.getElementById("app-notifications").show()}async init(){document.querySelector(".tasklist-adder__btn").addEventListener("click",t=>{t.target.style.display="none";const e=document.querySelector(".tasklist-adder__input");e.style.display="inherit",e.focus()}),document.addEventListener("keydown",this.onEscapeKeydown),document.querySelector(".tasklist-adder__input").addEventListener("keydown",this.onInputKeydown),document.getElementById("theme-switch").addEventListener("change",t=>{t.target.checked?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme")}),this.initAddTaskModal(),this.initEditTaskModal(),this.initDeleteTaskModal(),this.initNotifications(),document.addEventListener("dragover",t=>{t.preventDefault();const e=document.querySelector(".task.task_selected"),a=e.closest(".tasklist"),s=t.target,n=document.querySelector(".tasklist_droppable");let i=t.target;for(;!i.matches(".tasklist")&&i!==document.body;)i=i.parentElement;if(i!==n&&(n&&n.classList.remove("tasklist_droppable"),i.matches(".tasklist")&&i.classList.add("tasklist_droppable")),!(!i.matches(".tasklist")||e===s)){if(i===a){if(!s.matches(".task"))return;const r=s===e.nextElementSibling?s.nextElementSibling:s;i.querySelector(".tasklist__tasks-list").insertBefore(e,r);return}if(s.matches(".task")){i.querySelector(".tasklist__tasks-list").insertBefore(e,s);return}i.querySelector(".tasklist__tasks-list").children.length||i.querySelector(".tasklist__tasks-list").appendChild(e)}});try{const t=await S.getTasklists();for(const e of t){const a=new x({tasklistID:e.tasklistsID,name:e.name,position:e.position,onDropTaskInTasklist:this.onDropTaskInTasklist,addNotification:this.addNotification});o(this,u).push(a),a.render();for(const s of e.tasks)a.addNewTaskLocal({taskID:s.taskID,text:s.text,position:s.position,startDate:s.startDate,endDate:s.endDate})}}catch(t){this.addNotification({text:t.message,type:"error"}),console.error(t)}}}u=new WeakMap;document.addEventListener("DOMContentLoaded",()=>{new j().init()});
